---
- name: Generate SSH Keys
  tags: [ssh]
  vars:
    bmc: "{{ hostvars[hostvars[inventory_hostname]['bmc']]['tpi']['name'] }}"
  loop:
    - "{{ users.default }}"
    - "{{ users.provision }}"
  loop_control:
    loop_var: user
  ansible.builtin.include_tasks: ssh.yml

- name: Bootstrap
  tags: bootstrap
  block:
    - name: TPI Client
      tags: [tpi]
      ansible.builtin.import_role:
        name: tpi
        tasks_from: client-install.yml

    - name: Power Off Node
      ansible.builtin.import_role:
        name: tpi
        tasks_from: power-off.yml
