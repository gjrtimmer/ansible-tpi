# templates/netplan.yml.j2
network:
  version: 2
  ethernets:
    en-match:
      match:
        name: "en*"
      mtu: {{ network.profiles[profile].mtu if network.profiles[profile].mtu is defined else network.mtu | default(network.mtu) }}
      dhcp4: {{ 'true' if not network.static else 'false' | default(true) }}
      optional: true
{% if network.static | default(false) %}
      addresses:
        - {{ network.profiles[profile].nodes[inventory_hostname] }}/{{ network.profiles[profile].cidr.split('/')[1] }}
      gateway4: {{ network.profiles[profile].gateway }}
      nameservers:
        addresses:
          - {{ network.profiles[profile].dns }}
{% endif %}
    eth-match:
      match:
        name: "eth*"
      mtu: {{ network.profiles[profile].mtu if network.profiles[profile].mtu is defined else network.mtu | default(network.mtu) }}
      dhcp4: {{ 'false' if network.static else 'true' }}
      optional: true
{% if network.static | default(false) %}
      addresses:
        - {{ network.profiles[profile].nodes[inventory_hostname] }}/{{ network.profiles[profile].cidr.split('/')[1] }}
      gateway4: {{ network.profiles[profile].gateway }}
      nameservers:
        addresses:
          - {{ network.profiles[profile].dns }}
{% endif %}
